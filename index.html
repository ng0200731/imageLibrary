<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Library â€” Minimal Shell</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar" aria-label="Main menu">
      <div class="brand">
        <div class="hamburger">
          <div class="hamburger__line"></div>
          <div class="hamburger__line"></div>
          <div class="hamburger__line"></div>
        </div>
        <span>Image Library</span>
      </div>
      <nav class="menu">
        <a id="nav-library" class="menu__item is-active" href="#">Image Library</a>
        <a id="nav-upload" class="menu__item" href="#">Upload Image</a>
        <a id="nav-tags" class="menu__item" href="#">Tags</a>
        <a id="nav-settings" class="menu__item" href="#">Settings</a>
      </nav>

      <div class="version-wrapper">
          <span class="version">v1.3.0</span>
      </div>

      <div class="sidebar__footer">
        <button class="button button--primary" type="button">Login</button>
      </div>
    </aside>

    <main class="content">
      <!-- Image Library Page (Default) -->
      <div id="page-library" class="page">
        <header class="content__header">
          <h1 class="title">Image Library</h1>
          <div class="legend" style="margin-top:8px;">Solid = Objective, Dashed = Subjective</div>
        </header>
        <section class="panel">
          <p class="text">Your uploaded images will appear here.</p>
        </section>
      </div>

      <!-- Upload Image Page -->
      <div id="page-upload" class="page is-hidden">
          <header class="content__header">
            <h1 class="title">Upload Images</h1>
          </header>
          <section class="panel">
            <div id="dropzone" class="upload-area">
              <div class="preview-header">
                <h2 class="panel__title">Selected Images</h2>
                <div class="upload-actions">
                  <input type="file" id="file-input" class="file-input" multiple />
                  <label for="file-input" class="button">Browse Files</label>
                  <button id="clear-all" class="button" type="button">Clear All</button>
                </div>
              </div>
              <p class="text">Browse, drag & drop, or paste images</p>
              <div id="preview-grid" class="preview-grid"></div>
            </div>
            <div class="upload-actions">
                <button class="button button--primary" type="button">Upload</button>
            </div>
          </section>

          <!-- Layer 3: Tag panels -->
          <section class="panel">
            <div class="apply-scope">
              Apply to: <button id="apply-all" class="button" type="button">All images</button>
              <button id="apply-selected" class="button" type="button">Selected only</button>
              <span class="legend">Solid = Objective, Dashed = Subjective</span>
            </div>

            <div class="tag-panels">
              <div class="tag-panel tag-panel--objective">
                <div class="tag-panel__header is-objective">OBJECTIVE (FACTS)</div>
                <div class="tag-panel__body">
                  <label class="tag-input">
                    brand: <input id="obj-brand" type="text" placeholder="brand:nike" />
                  </label>
                  <label class="tag-input">
                    color: <input id="obj-color" type="text" placeholder="color:red" />
                  </label>
                  <div id="obj-chips" class="chips"></div>
                </div>
              </div>

              <div class="tag-panel tag-panel--subjective">
                <div class="tag-panel__header is-subjective">SUBJECTIVE (FEELINGS)</div>
                <div class="tag-panel__body">
                  <div class="subj-inline">
                    <div>
                      <label class="tag-input">Add feelings:
                        <input id="subj-input" type="text" placeholder="type and press Enter/Tab" />
                      </label>
                      <div class="hint">Press Enter or Tab to add; Backspace removes last when empty</div>
                    </div>
                    <div id="subj-chips" class="chips"></div>
                  </div>
                </div>
              </div>
            </div>
          </section>
      </div>
    </main>
  </div>


  <!-- Lightbox Modal -->
  <div id="lightbox-modal" class="modal is-hidden">
    <span class="modal-close">&times;</span>
    <img class="modal-content" id="lightbox-image">
  </div>

  <script>
    // --- Page Navigation ---
    const navLinks = {
        library: document.getElementById('nav-library'),
        upload: document.getElementById('nav-upload'),
    };
    const pages = {
        library: document.getElementById('page-library'),
        upload: document.getElementById('page-upload'),
    };

    function navigateTo(pageName) {
        Object.values(pages).forEach(page => page.classList.add('is-hidden'));
        document.querySelectorAll('.menu__item').forEach(link => link.classList.remove('is-active'));
        pages[pageName].classList.remove('is-hidden');
        navLinks[pageName].classList.add('is-active');
    }

    navLinks.library.addEventListener('click', (e) => { e.preventDefault(); navigateTo('library'); });
    navLinks.upload.addEventListener('click', (e) => { e.preventDefault(); navigateTo('upload'); });

    // --- Upload Page Logic ---
    const fileInput = document.getElementById('file-input');
    const previewGrid = document.getElementById('preview-grid');
    const clearAllButton = document.getElementById('clear-all');
    const dropzone = document.getElementById('dropzone');

    function handleFiles(files) {
        if (files.length === 0) return;
        for (const file of files) {
            if (!file.type.startsWith('image/')) continue;
            const reader = new FileReader();
            reader.onload = (e) => {
                const card = document.createElement('div');
                card.className = 'preview-card';
                const del = document.createElement('button');
                del.type = 'button';
                del.className = 'delete-btn';
                del.textContent = 'x';
                del.addEventListener('click', () => card.remove());
                const img = document.createElement('img');
                img.src = e.target.result;
                img.addEventListener('click', () => openModal(e.target.result));
                card.appendChild(del);


                card.appendChild(img);
                previewGrid.appendChild(card);
            };
            reader.readAsDataURL(file);
        }
    }

    fileInput.addEventListener('change', (event) => {
        handleFiles(event.target.files);
    });

    clearAllButton.addEventListener('click', () => {
        previewGrid.innerHTML = '';
        previewArea.classList.add('is-hidden');
        fileInput.value = '';
    });


    // --- Subjective input: add chips with Enter/Tab/Comma ---
    const subjInput = document.getElementById('subj-input');
    const subjChips = document.getElementById('subj-chips');

    function addSubjChip(label) {
        const text = (label || '').toLowerCase().trim();
        if (!text) return;
        // no duplicates
        if ([...subjChips.querySelectorAll('.chip')].some(c => c.textContent === text)) return;
        const chip = document.createElement('span');
        chip.className = 'chip is-subjective';
        chip.textContent = text;
        chip.tabIndex = 0; // focusable for delete
        chip.addEventListener('click', () => chip.classList.toggle('is-selected'));
        const x = document.createElement('button');
        x.type = 'button';
        x.className = 'x';
        x.textContent = 'x';
        x.addEventListener('click', (ev) => { ev.stopPropagation(); chip.remove(); });
        chip.appendChild(x);
        subjChips.appendChild(chip);
    }

    function handleSubjCommit() {
        const parts = subjInput.value.split(',');
        parts.forEach(p => addSubjChip(p));
        subjInput.value = '';
    }

    subjInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === 'Tab') {
            e.preventDefault();
            handleSubjCommit();
        } else if (e.key === ',' ) {
            e.preventDefault();
            handleSubjCommit();
        } else if (e.key === 'Backspace' && subjInput.value === '') {
            const chips = subjChips.querySelectorAll('.chip');
            const last = chips[chips.length - 1];
            if (last) subjChips.removeChild(last);
        }
    });

    // --- Drag and Drop Logic ---
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => dropzone.classList.add('is-dragover'), false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => dropzone.classList.remove('is-dragover'), false);
    });
    dropzone.addEventListener('drop', (e) => {
        handleFiles(e.dataTransfer.files);
    }, false);

    // --- Paste Logic ---

    // --- Lightbox Modal Logic ---
    const modal = document.getElementById('lightbox-modal');
    const modalImg = document.getElementById('lightbox-image');
    const closeModal = document.querySelector('.modal-close');

    function openModal(src) {
        modalImg.src = src;
        modal.classList.remove('is-hidden');
    }

    function hideModal() {
        modal.classList.add('is-hidden');
    }

    closeModal.addEventListener('click', hideModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            hideModal();
        }
    });

    window.addEventListener('paste', (e) => {
        if (pages.upload.classList.contains('is-hidden')) return;
        handleFiles(e.clipboardData.files);
        // Visual feedback on dropzone for paste
        dropzone.classList.add('is-dragover');
        setTimeout(() => dropzone.classList.remove('is-dragover'), 150);
    });
  </script>
</body>
</html>

